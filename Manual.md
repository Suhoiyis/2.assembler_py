### **RISC-V 汇编器 (Assembler) 使用说明书**

**文档版本：1.1**
**最后更新：2025年9月30日**

#### **1. 简介**

本程序是一个轻量级的RISC-V指令集汇编器。它的核心功能是将人类可读的RISC-V汇编语言指令，精确地转换为计算机能够执行的32位二进制机器码。

本说明书旨在帮助您理解其全部功能，并指导您如何正确地进行操作。

#### **2. 核心功能**

  * **广泛的指令支持**:

      * 支持 **RV32I** 基础整数指令集，包括 `R`, `I`, `S`, `B`, `U`, `J` 全部六种格式的指令。
      * 支持 **RV32M** 乘除法标准扩展指令集 (例如 `mul`, `div` 等)。

  * **灵活的寄存器表示**:

      * 同时支持物理寄存器名 (如 `x5`, `x10`) 和 ABI 约定名称 (如 `t0`, `sp`, `ra`, `a0` 等)，使汇编代码编写更直观、更具可读性。

  * **大小写不敏感**:

      * 指令助记符 (Mnemonic) 不区分大小写。例如，`add`, `ADD`, 和 `Add` 均可被程序正确识别。

  * **智能注释处理**:

      * 能够自动忽略以 `#` 开头的**整行注释**。
      * 能够自动剥离并忽略跟在有效指令末尾的**行内注释**。

  * **精确的立即数编码**:

      * 正确处理正、负立即数，并将其转换为二进制补码形式。
      * 精确实现B型 (分支) 和J型 (跳转) 指令中，立即数比特位被拆分和重排的复杂编码规则。

  * **路径自动适应**:

      * 脚本能够自动计算所需文件的绝对路径，这意味着无论您是通过终端运行，还是直接在IDLE等集成开发环境中按下“运行”按钮，程序都能正确找到输入和输出文件。

  * **标签跳转**:

      * 支持使用标签 (如 `loop_start`, `func_end`) 进行跳转。
      * 标签跳转指令 (如 `j`, `jal`, `beq`, `bne`) 中，立即数部分会被自动替换为目标标签的地址偏移量。

#### **3. 文件结构**

为了让程序正常工作，请务必保持以下目录结构：

```
<2.assembler_py>/
├── 📁 src/
│ └── 🐍 assembler.py # Python 汇编器脚本
│
├── 📁 data/
│ ├── 📄 input.txt # 汇编指令输入文件
│ ├── 📄 output.txt # 汇编生成的 32 位机器码
│
├── 📁 material/
│ ├── 📁 pngs/ # 图片素材
│ ├── 📝 registers.md # 寄存器说明文档
│ ├── 📝 codes.md # 指令说明文档
│ └── 📊 指令.ppt # 指令演示文稿
│
├── 📘 manual.md # 使用说明（本文件）
├── 📝 Development_Log.md # 开发日志
└── 📖 README.md # 项目说明文件
```

#### **4. 如何使用**

**步骤一：准备汇编代码**

在 `data/input.txt` 文件中编写您的RISC-V汇编指令，每行一条。您可以自由使用寄存器ABI名称和注释

**步骤二：运行脚本**

您有两种推荐的运行方式：

  * **方法A：通过终端 (推荐)**

    1.  打开您的终端 (命令行工具)。
    2.  使用 `cd` 命令进入您的项目**根目录** (包含`src`和`data`文件夹的那一级)。
    3.  执行命令： `python src/assembler.py`

  * **方法B：通过 IDLE 或其他IDE**

**步骤三：查看输出**

脚本运行成功后，`data/output.txt` 文件的内容将被自动更新。其中将包含与 `input.txt` 指令一一对应的32位二进制机器码。

#### **5. 错误与警告处理**

  * 如果 `input.txt` 中的某一行指令存在语法错误、包含无效的寄存器名或是不被支持的指令，程序将在终端/控制台打印出对应的**警告信息**并跳过该行，继续处理文件的其余部分。
  * 如果 `input.txt` 文件为空或不存在，程序也会打印相应的提示信息。

-----